# Contexto del Proyecto - Monitoreo API REST

**IMPORTANTE: Este archivo debe ser le√≠do al inicio de cada sesi√≥n para entender el entorno del proyecto.**

## üåç Entornos

### Producci√≥n
- **Base de Datos:** 
  - Host: `dbsrv.movingenia.com`
  - Usuario: `transito`
  - Password: `transito`
  - Puerto: 5432 (PostgreSQL)
  
- **Servidor de Aplicaci√≥n:**
  - Host: `apps.movingenia.com`
  - Frontend: Se sirve desde este servidor
  - Backend API: Se ejecuta en este servidor

### Desarrollo/Pruebas
- **Base de Datos:**
  - Host: `192.168.18.230`
  - Usuario: `transito`
  - Password: `transito`
  - Puerto: 5432 (PostgreSQL)

- **Servidor Local:**
  - Backend: Puerto 3001
  - Frontend: Puerto 5173 (Vite dev server)

## üîß Notas Importantes

1. **Al trabajar con la base de datos:** Por defecto se trabaja con la base de datos de **PRODUCCI√ìN** en `dbsrv.movingenia.com`
2. **Al visualizar el frontend:** Se est√° visualizando el **FRONTEND DE PRODUCCI√ìN** en `apps.movingenia.com`
3. **Para consultas a la BD de producci√≥n:** Usar las credenciales de producci√≥n
4. **Para consultas a la BD de desarrollo:** Usar host `192.168.18.230`

## üìù Comandos √ötiles

### Conexi√≥n a Base de Datos de Producci√≥n
```bash
psql -h dbsrv.movingenia.com -U transito -d monitoreo
# Password: transito
```

### Conexi√≥n a Base de Datos de Desarrollo
```bash
psql -h 192.168.18.230 -U transito -d monitoreo
# Password: transito
```

### Consultas Comunes
```sql
-- Ver men√∫s existentes
SELECT id, codigo, name, modulo, url, estado FROM menus ORDER BY id;

-- Ver grupos
SELECT id, nombre, descripcion, estado FROM grupos ORDER BY id;

-- Ver permisos de un grupo
SELECT gm.*, m.name as menu_nombre, a.nombre as accion_nombre 
FROM grupos_menus gm
JOIN menus m ON gm.menu_id = m.id
JOIN acciones a ON gm.accion_id = a.id
WHERE gm.grupo_id = 1;
```

## üèóÔ∏è Arquitectura

- **Frontend:** React + TypeScript + Vite
- **Backend:** NestJS + TypeScript
- **Base de Datos:** PostgreSQL 13+
- **ORM:** Prisma
- **Gestor de Procesos:** PM2 (SIEMPRE usar PM2, NO npm run dev directamente)

## üîß Gesti√≥n de Procesos con PM2

**IMPORTANTE:** En local se administra con PM2, NO iniciar procesos con npm directamente.

```bash
# Ver procesos en ejecuci√≥n
pm2 status

# Ver logs
pm2 logs

# Reiniciar todos los procesos
pm2 restart all

# Reiniciar un proceso espec√≠fico
pm2 restart <nombre>

# Detener todos
pm2 stop all

# Iniciar todos
pm2 start ecosystem.config.js
```

El archivo de configuraci√≥n es `ecosystem.config.js` en la ra√≠z del proyecto.

## ‚ö†Ô∏è Precauciones

- **SIEMPRE usar PM2** para gestionar procesos en local, NO npm run dev
- Siempre confirmar en qu√© entorno se est√° trabajando antes de hacer cambios
- Las migraciones deben probarse primero en desarrollo
- Los cambios en producci√≥n requieren backup previo
